import{aS as e,b$ as ce,b9 as G,bg as M,aG as y,ba as i,bj as q,br as C,a$ as ee,bn as E,bp as F,bs as A,bq as H,be as te,aU as R,aW as ue,cl as pe,bo as ae,cu as me,dc as he,aT as ge,dd as fe,bh as re,cs as ye,dn as be,bu as $,dk as ke,dl as Se,dm as ve,bv as j,by as U,bz as V,bA as I,di as z,bF as Ce,bk as De,cF as $e,ca as xe,r as Te,cc as Re,bc as Be}from"./vendor.5ff35c24.js";import{a as v}from"./vendor_axios.5abceb0c.js";import{L as Pe,N as we,A as N,M as Ae,B as Le}from"./index.6e13cccf.js";import Ie from"./ViewAssessments.3d0596aa.js";import We from"./AddPartner.f0d07b48.js";import{u as Oe,a as Ne,C as W}from"./vendor_react_hook_form.99ff4ff5.js";import"./vendor_core_js_pure.7f605738.js";import"./vendor_react_epic_spinners.792a5510.js";import"./vendor_mui_datatables.34fc80b0.js";import"./vendor_lodash.dde4158d.js";import"./vendor_react_slick.468a9aef.js";import"./vendor_react_easy_edit.886afc3d.js";import"./vendor_react_player.223b9460.js";import"./vendor_react_json_view.4f18b120.js";const X=({text:s,url:t})=>e(ce,{target:"_blank",style:{color:"#f05f40"},to:{pathname:t},children:s}),Me="https://join.navgurukul.org/api/",qe=G(s=>({container:{display:"flex",flexWrap:"wrap",flexDirection:"column",maxWidth:400},btn:{marginTop:s.spacing(4)},text:{marginBottom:s.spacing(1)}})),Ee=({name:s,notes:t,partnerId:a,change:l,columnIndex:c})=>{const m=qe(),{enqueueSnackbar:u}=M(),[g,k]=y.useState(!1),[d,o]=y.useState({name:s!=null?s:"",notes:t!=null?t:"",slug:""}),S=async()=>{try{const b=`${Me}partners/${a}`;await v.put(b,{name:d.name,notes:d.notes,slug:d.slug}).then(()=>{k(!1),u("Partner successfully edited with slug!",{variant:"success"}),l(d.slug,c)})}catch{u("All fields are mandatory Or Slug should be unique",{variant:"error"})}},B=()=>S(),x=b=>{o({...d,[b.target.name]:b.target.value})},P=()=>{k(b=>!b)};return i(q,{children:[e(C,{variant:"outlined",startIcon:e(ee,{}),onClick:P,children:"Add Slug"}),i(E,{open:g,onClose:P,children:[i(F,{className:m.container,children:[e(A,{id:"partnerName",name:"name",label:"Partner Name",value:d.name,onChange:x,helperText:"Partner ka Name Enter karein."}),e(A,{id:"partnerNotes",name:"notes",value:d.notes,label:"Partner Notes",onChange:x,helperText:"Partner ka Name Enter karein."}),e(A,{id:"partnerSlug",name:"slug",value:d.slug,label:"Partner Slug",onChange:x,helperText:"Partner ke student ko online test dene ke liye Slug add karo."})]}),i(H,{children:[e(C,{variant:"outlined",onClick:P,children:"Cancel"}),e(C,{variant:"contained",color:"primary",onClick:B,children:"Edit Partner"})]})]})]})},Fe="https://join.navgurukul.org/api/",_e=s=>{const t=M(),[a,l]=y.useState({dialogOpen:!1,inputValue:"",loading:!1}),c=async()=>{const{partnerId:o}=s,S=`${Fe}partners/${o}/assessments`;await v.post(S,{name:a.inputValue}).then(()=>{l({...a,loading:!1}),t.enqueueSnackbar("Assessment successfully created!",{variant:"success"})}).catch(B=>{t.enqueueSnackbar(B,{variant:"error"})})},m=()=>{l({...a,dialogOpen:!1})},u=async()=>{m(),l(o=>({...o,loading:!0})),c()},g=()=>{l({...a,dialogOpen:!0})},k=o=>{l({...a,inputValue:o.target.value})},{loading:d}=a;return i(q,{children:[i(te,{children:[d?null:e(R,{onClick:g,children:e(ue,{})}),e(pe,{size:35,color:"#ed343d",width:5,visible:d})]}),i(E,{open:a.dialogOpen,onClose:m,children:[e(ae,{id:"form-dialog-title",children:"Create New Assessment"}),i(F,{children:[e(me,{children:"Please fill out the paper set name"}),e(A,{label:"Paper set name",value:a.inputValue,placeholder:"Set A",onChange:k,margin:"normal"})]}),e(H,{children:e(C,{color:"primary",variant:"contained",onClick:u,children:"CREATE"})})]})]})},je="https://join.navgurukul.org/api/",Ue=G(s=>({container:{display:"flex",justifyContent:"center",alignItems:"center"},link:{color:"#f05f40",padding:s.spacing(3,1)}})),Ve=({isValue:s,studentId:t,updateValue:a})=>{const l=Ue(),{enqueueSnackbar:c}=M(),m=async()=>{v({method:"put",url:`${je}partners/${t}/merakiLink`,headers:{platform:"android"}}).then(u=>{c("Meraki link successfully created",{variant:"success"});const g=u.data.data.meraki_link;a(g)}).catch(()=>{c("Something went wrong",{variant:"error"})})};return s?i("div",{className:l.container,children:[e(he,{text:s,onCopy:(u,g)=>{g&&c("Link Copied!",{variant:"success"})},children:e(ge,{title:"Copy Meraki Link",style:{background:"#f05f40"},children:e(R,{children:e(fe,{sx:{color:"white"}})})})}),e("a",{className:l.link,href:s,target:"_blank",rel:"noreferrer noopener",children:"Get Link"})]}):e(C,{variant:"contained",color:"primary",onClick:()=>m(),children:"Create"})},ze=s=>{const{privileges:t}=re(g=>g.auth),[a,l]=y.useState(!1),c=()=>l(!1),m=()=>l(!0),{value:u}=s;return i(q,{children:[e(R,{disabled:!t.some(g=>g.privilege==="UpdatePartner"),onClick:m,children:e(ee,{})}),e(E,{scroll:"paper",open:a,onClose:c,children:e(F,{dividers:!0,children:e(We,{partnerId:u,closeDialog:c})})})]})},O="https://join.navgurukul.org/api/",Ge=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],He=[...Array(31)].map((s,t)=>t+1),Ye=({partnerId:s})=>{var J,K,Q;const{enqueueSnackbar:t}=M(),[a,l]=y.useState(!0),[c,m]=y.useState(!1),[u,g]=y.useState({emails:[""],repeat:"Daily",date:[],status:1,report:"Outreach",emailreportId:null}),{handleSubmit:k,formState:{errors:d},control:o,watch:S,reset:B,setValue:x}=Oe(),{fields:P,append:b,remove:ne}=Ne({control:o,name:"emails"}),Y=(p,r)=>p==="Daily"?p:`${p} ${["Bi-Weekly","Bi-Monthly"].includes(p)?r.join(" "):r}`,L=()=>m(!1),le=p=>{const{emails:r,repeat:n,date:h,status:f,report:w}=p;v.post(`${O}partners/emailreport`,{partner_id:s,emails:r.map(_=>_.email),repeat:Y(n,h),status:!!f,report:w}).then(()=>{t(`Report ready to share  ${n} bases`,{variant:"success"}),L()})},se=async p=>{const{report:r,emailreportId:n,emails:h,repeat:f,date:w,status:_}=p;v.put(`${O}partners/emailreport/${n}`,{partner_id:s,emails:h.map(de=>de.email),repeat:Y(f,w),status:!!_,report:r}).then(()=>{t("Report successfully updated",{variant:"success"}),L()})},ie=()=>{v.get(`${O}emailreport/send/partner/${s}`).then(()=>{t("Instant Report Sent!!!",{variant:"success"})})},oe=()=>{m(!0),v.get(`${O}partners/emailreport/${s}`).then(p=>{const r=p.data.data[0];if(r){const n=r.repeat.split(" "),h=n.splice(1,n.length);g(f=>({...f,emails:r.emails.map(w=>({email:w})),repeat:n[0],date:h,status:r.status?1:0,report:r.report,emailreportId:r.id})),B({emails:r.emails.map(f=>({email:f})),repeat:n[0],date:h,status:r.status?1:0,report:r.report,emailreportId:r.id}),l(!1)}})},D=S("repeat"),Z=S("date"),T=(D==null?void 0:D.indexOf("Weekly"))>-1;return i("div",{children:[e(R,{onClick:oe,children:e(ye,{})}),e(R,{onClick:ie,children:e(be,{style:{marginLeft:"10px"}})}),i(E,{open:c,style:{overflow:"scroll"},onClose:L,maxWidth:"xs",fullWidth:!0,children:[e(ae,{children:"Send Report To Partner"}),e(F,{sx:{display:"flex",flexDirection:"column"},children:a?e(Pe,{container:!0}):i($,{container:!0,sx:{mt:"0.2rem"},spacing:2,children:[P.map((p,r)=>{var n;return i(y.Fragment,{children:[e($,{item:!0,xs:9,children:e(W,{control:o,defaultValue:((n=u.emails[r])==null?void 0:n.email)||"",name:`emails[${r}].email`,rules:{required:!0,pattern:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/},render:({field:{ref:h,...f}})=>e(A,{variant:"outlined",fullWidth:!0,id:`emails[${r}]`,name:`emails[${r}]`,inputRef:h,label:`Partner Email ${r+1}`,placeholder:`Partner Email ${r+1}`,autoComplete:"off",type:"email",error:!!d.emails&&!!d.emails[r],helperText:d.name?"Required Field":`Enter Partner Email ${r+1}`,...f})})}),e($,{item:!0,xs:2,sx:{display:"flex",alignItems:"center",justifyContent:"left"},children:e(R,{color:"primary",size:"large",onClick:()=>ne(r),style:{borderSpacing:"-1"},children:e(ke,{})})})]},p.id)}),e($,{item:!0,xs:12,sx:{mY:"0.2rem"},children:i(C,{variant:"outlined",color:"primary",onClick:()=>b(),children:[e(Se,{style:{display:"flex",alignItems:"center",marginRight:"1vh"},children:e(ve,{})}),"Add Another District"]})}),i($,{item:!0,xs:12,children:[e(W,{control:o,rules:{required:!0},name:"repeat",defaultValue:(J=u.repeat)!=null?J:"Select Timeline",render:({field:{ref:p,...r}})=>i(j,{variant:"outlined",fullWidth:!0,children:[e(U,{id:"repeat-label",children:"Select Timeline"}),e(V,{label:"Select Timeline",placeholder:"Select Timeline",error:!!d.report,id:"repeat",inputRef:p,required:!0,...r,onChange:n=>{const{target:{value:h}}=n;x("date",["Bi-Weekly","Bi-Monthly"].includes(h)?[]:""),r.onChange(n)},children:["Select Timeline","Daily","Weekly","Bi-Weekly","Monthly","Bi-Monthly"].map(n=>e(I,{value:n,disabled:n==="Select Timeline",children:n},n))})]})}),d.repeat?e(z,{style:{paddingLeft:"0.8rem",paddingTop:"0.4rem",paddingBottom:"0.4rem"},color:"error",children:"Select Timeline"}):""]}),D!=="Daily"&&i($,{item:!0,xs:12,children:[e(W,{control:o,rules:{required:!0},name:"date",defaultValue:(K=u.date)!=null?K:"",render:({field:{ref:p,...r}})=>i(j,{variant:"outlined",fullWidth:!0,children:[i(U,{id:"repeat-label",children:["Select ",T?"Day":"Date"]}),i(V,{label:`Select ${T?"Day":"Date"}`,placeholder:`Select ${T?"Day":"Date"}`,error:!!d.date,id:"date",multiple:["Bi-Weekly","Bi-Monthly"].includes(D),inputRef:p,required:!0,renderValue:n=>["Bi-Weekly","Bi-Monthly"].includes(D)?e(Ce,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:n.map(h=>e(De,{onMouseDown:f=>{f.stopPropagation()},label:h,onDelete:()=>{x("date",Z.filter(f=>f!==h))}},h))}):n,...r,children:[i(I,{value:"",disabled:!0,children:["Select ",T?"Day":"Date"]}),(T?Ge:He).map(n=>i(I,{value:n,disabled:n==="Select Timeline",children:[["Bi-Weekly","Bi-Monthly"].includes(D)&&e($e,{size:"small",checked:Z.includes(n)}),n]},n))]})]})}),d.date?i(z,{style:{paddingLeft:"0.8rem",paddingTop:"0.4rem",paddingBottom:"0.4rem"},color:"error",children:["Select ",T?"Day":"Date"]}):""]}),i($,{item:!0,xs:12,children:[e(W,{control:o,rules:{required:!0},name:"status",defaultValue:(Q=u.status)!=null?Q:1,render:({field:{ref:p,...r}})=>i(j,{variant:"outlined",fullWidth:!0,children:[e(U,{id:"repeat-label",children:"Select Status"}),e(V,{label:"Select Status",placeholder:"Select Status",error:!!d.status,id:"status",inputRef:p,required:!0,...r,children:[{value:"Select Status",label:"Select Status"},{value:1,label:"Yes"},{value:0,label:"No"}].map(({value:n,label:h})=>e(I,{value:n,disabled:n==="Select Status",children:h},n))})]})}),e(z,{style:{paddingLeft:"0.8rem",paddingTop:"0.4rem",paddingBottom:"0.4rem"},children:"Do you want to share report ?"})]})]})}),i(H,{children:[e(C,{variant:"outlined",onClick:L,children:"Cancel"}),e(C,{variant:"contained",color:"primary",disabled:a,onClick:k(u.emailreportId?se:le),children:u.emailreportId?"Edit Send Report":"Send Report"})]})]})]})},Ze="https://join.navgurukul.org/api/",Je=G(()=>({innerTable:{marginLeft:"3vw",marginRight:"3vw",width:"94vw",marginTop:"5",marginBottom:"5",[N.breakpoints.up("md")]:{margin:"auto",marginTop:5,marginBottom:5}},buttons:{display:"flex",gap:N.spacing(2),margin:N.spacing(2)}})),Ke=s=>[{name:"id",label:"Edit Partner Details",options:{filter:!1,sort:!0,customBodyRender:t=>e(ze,{value:t})}},{name:"name",label:"Name",options:{filter:!0,sort:!0,filterType:"custom",filterOptions:{logic:(t,a)=>a[0]==="All"||a[0]===void 0?!1:!a.includes(t),display:(t,a,l,c)=>i(q,{children:[e(Be,{variant:"caption",children:"Name"}),e(Le,{options:[{name:"All"},...s].map(({name:m})=>({value:m,label:m})),filterList:t,onChange:a,index:l,column:c,value:t[l].length===0?"All":t[l]})]}),fullWidth:!0},customBodyRender:(t,a)=>{const l=a.rowData[0];return e(X,{url:`/partner/${l}`,text:t,name:t})}}},{name:"notes",label:"View Assessments",options:{filter:!1,sort:!1,customBodyRender:(t,a)=>e(Ie,{partnerId:a.rowData[0]})}},{name:"name",label:"Create Assessment",options:{filter:!1,sort:!1,customBodyRender:(t,a)=>e(_e,{partnerId:a.rowData[0],partnerName:t})}},{name:"id",label:"Joined Students Progress",options:{filter:!1,sort:!1,customBodyRender:(t,a)=>{const l=a.rowData[3];return e(X,{url:`/partner/${t}/progress`,text:"Get Information",name:l})}}},{name:"slug",label:"Online Test For Partner",options:{filter:!1,sort:!1,customBodyRender:(t,a,l)=>{if(t){const c=`/partnerLanding/${t}`;return e("div",{children:e("a",{href:c,target:"_blank",rel:"noreferrer noopener",style:{color:"#f05f40"},children:"Go for test"})})}return e(Ee,{columnIndex:a.columnIndex,partnerId:a.rowData[0],name:a.rowData[3],notes:a.rowData[2],change:c=>l(c)})}}},{name:"meraki_link",label:"Meraki Link",options:{filter:!1,sort:!1,customBodyRender:(t,a,l)=>e(Ve,{isValue:t,studentId:a.rowData[0],updateValue:l})}},{name:"id",label:"Send Report",options:{filter:!1,sort:!1,customBodyRender:t=>e(Ye,{partnerId:t})}}],pt=()=>{const s=Je(),{privileges:t}=re(o=>o.auth),a=xe(),[l,c]=y.useState(!0),[m,u]=y.useState([]),g=o=>{u(o)},k=async()=>{try{const o=`${Ze}partners`,S=await v.get(o,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt")}`}});g(S.data.data)}catch(o){console.error(o)}};Te.exports.useEffect(()=>{(async()=>(c(!0),await k(),c(!1)))()},[]);const d={customToolbar:y.useCallback(()=>e(we,{handleOpen:()=>a("/partner/add"),disabled:!t.some(o=>o.privilege==="AddPartner")}),[])};return e(te,{children:e(Re,{theme:N,children:e("div",{className:s.innerTable,children:e(Ae,{title:"Partners",columns:Ke(m),data:m,options:d,tableBodyMaxHeight:"74vh",showLoader:l})})})})};export{pt as default};
