import{aS as e,aT as ot,aU as M,aV as nt,bG as N,bh as lt,bi as ct,r as m,aG as x,ba as u,bu as T,be as it,bn as A,bp as rt,bX as ut,bv as dt,by as pt,de as ht,df as mt,bs as B,bq as gt,br as ft,ce as bt,bg as St,bw as vt,b9 as yt,bj as xt,dg as Ct,bF as wt,bc as Dt}from"./vendor.5ff35c24.js";import{M as Ft}from"./vendor_mui_datatables.34fc80b0.js";import{a as y}from"./vendor_axios.5abceb0c.js";import{o as _,M as Ot,d as Rt,e as kt,q as $t,c as Tt,g as I,h as jt,k as Lt,l as Nt}from"./index.6e13cccf.js";const _t=({handleOpen:o,disabled:d})=>e(ot,{title:"Add schools",children:e(M,{disabled:d,onClick:o,children:e(nt,{})})}),w="https://join.navgurukul.org/api/",Gt=({url:o,isCampus:d=!1})=>{const f=N(),{allStudents:g,fromDate:p,toDate:b,allStatusCount:S}=lt(t=>t.campus),c=ct(),[h,n]=m.exports.useState(!1),v=()=>c(Tt(!1)),D=t=>c(Lt(t)),C=t=>c(Rt(t)),E=t=>c(Nt(t)),q=()=>c(kt()),W=[{name:"id",label:"S.No",options:{filter:!0,sort:!0,customBodyRender:(t,a)=>a.rowIndex+1}},{name:"name",label:"School Name",options:{filter:!0,sort:!0,customBodyRender:(t,a)=>t}},{name:"capacity",label:"Capacity of students",options:{filter:!0,sort:!0,customBodyRender:(t,a)=>t}}],[U,G]=m.exports.useState([]),[V,P]=m.exports.useState([]),[F,X]=m.exports.useState(""),[O,Y]=m.exports.useState(""),R=N().pathname.split("/")[2],j=async()=>{const t=`${w}school/campus_school/${R}`,a=await y.get(t);G(a==null?void 0:a.data)};m.exports.useEffect(()=>{j()},[]);const z=async()=>{if(O&&F&&R){const t=`${w}school/capacity?campus_id=${R}&school_id=${F}`;await y.put(t,{capacityofschool:O})}n(!1),j()},H=async()=>{const t=`${w}school`,a=await y.get(t);P(a.data)},J=()=>{n(!0)},L={selectableRows:"none",responsive:"vertical",filter:!1,customToolbar:x.useCallback(()=>e(_t,{handleOpen:J}),[])},[Q,Z]=x.useState(!0),K=t=>{if(d){const r=I.reduce((l,s)=>({...l,[s]:0}),{total:0}),i=t.reduce((l,s)=>(s.stage.campus_status&&I.includes(s.stage.campus_status)&&(l[s.stage.campus_status]+=1),l),r);i.total=t.length,D(i)}const a=t.map(r=>jt(r,d));C(a),E(a),Z(!1)},tt=async t=>{try{const a=w+o,r=await y.get(a,{signal:t,params:{from:p,to:b}}),i={},l=r.data.data.map(s=>{const k=s.lastTransition?s.lastTransition.to_stage:"other",$=s.contacts[s.contacts.length-1];return i[k]?i[k]+=1:i[k]=1,{...s,qualification:$t[s.qualification],altNumber:$&&$.alt_mobile,donor:s.studentDonor?s.studentDonor:null}});l.length>0&&(l[0]={...l[0],...i}),K(l)}catch{v()}};m.exports.useEffect(()=>{const t=new AbortController;return(async()=>await tt(t.signal))(),()=>{t.abort(),C([]),q()}},[]);const et=f.pathname.split("/")[1],at=x.useCallback(()=>e("tbody",{}),[]),st=g.length>0&&u(T,{container:!0,spacing:3,sx:{paddingY:"0.8rem"},children:[e(T,{item:!0,container:!0,xs:12,md:6,lg:3,sx:{display:"flex",flexDirection:"column",justifyContent:"center",width:"100%"}}),e(T,{item:!0,xs:12,md:12,lg:6,children:e(Ft,{columns:Object.keys(S).map(t=>{var a,r,i,l;return{name:t,label:(r=(a=_[t])==null?void 0:a.label)!=null?r:"Total",options:{display:(l=(i=_[t])==null?void 0:i.display)!=null?l:!0}}}),title:"Campus Counts",data:[S],options:{customFooter:at,filter:!1,sort:!1,showTitle:!1,viewColumns:!0,print:!1,search:!1,selectableRows:"none",toolbar:!1}})})]});return u(it,{sx:{paddingX:"30rem",paddingY:"0.2rem"},children:[et==="campus"?st:L,e(Ot,{tableBodyMaxHeight:"56vh",title:"Programs offered",columns:W,data:U,showLoader:Q,options:L}),e(A,{fullWidth:!0,open:h,onClose:()=>n(!1),children:u("section",{style:{padding:"0rem 1rem 1rem 1rem"},children:[u(rt,{children:[u("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("p",{style:{fontSize:"24px"},children:"Add School"}),e(ut,{style:{cursor:"pointer"},onClick:()=>n(!1)})]}),u(dt,{fullWidth:!0,children:[e(pt,{label:"school add",variant:"outlined",htmlFor:"uncontrolled-native",children:"Schools"}),e(ht,{defaultValue:30,input:e(mt,{label:"Name"}),onClick:H,value:F,onChange:t=>{t.preventDefault(),X(t.target.value)},children:V.map(t=>u("option",{value:t.id,children:[" ",t.name]},t.id))})]}),e("div",{children:e(B,{fullWidth:!0,autoFocus:!0,label:"No of Students",placeholder:"Enter School",variant:"outlined",sx:{mt:"2rem"},value:O,onChange:t=>{t.preventDefault(),Y(t.target.value)}})})]}),e(gt,{style:{display:"flex",justifyContent:"center"},children:e(ft,{variant:"contained",color:"primary",style:{width:"94%",padding:".5rem"},onClick:z,children:"Add School"})})]})})]})},It="https://join.navgurukul.org/api/",Mt=bt(),Vt=({evaluation:o,rowMetatable:d,change:f})=>{const{enqueueSnackbar:g}=St(),p=n=>{const v=d.rowData[0],{value:D,label:C}=n;y.put(`${It}students/${v}`,{evaluation:D}).then(()=>{g("evaluation is successfully added!",{variant:"success"}),f(C)}).catch(()=>{g("Something went wrong!",{variant:"error"})})},b=async n=>{const{value:v}=n;v&&p(n)},c=["Struggling","Manageable","Good","Excellent"].map(n=>({label:n,value:n}));return e(vt,{className:"filterSelectStage",value:{value:o,label:o},onChange:b,options:c,isClearable:!1,components:Mt,closeMenuOnSelect:!0})},At=yt(o=>({container:{display:"flex",flexWrap:"wrap",flexDirection:"column",maxWidth:400},textField:{marginLeft:o.spacing(1),marginRight:o.spacing(1),width:400},btn:{marginTop:o.spacing(4)}})),Pt=({comment:o})=>{const d=At(),[f,g]=x.useState(!1),[p,b]=x.useState(o),S=h=>b(h.target.value.length===0?h.target.value:""),c=()=>{g(h=>!h)};return u(xt,{children:[e(M,{onClick:c,children:e(Ct,{sx:{color:`${o?"red":"green"}`}})}),e(A,{open:f,onClose:c,children:u(wt,{sx:{py:"0.6rem",px:"0.2rem"},children:[e(Dt,{variant:"h4",fontWeight:"medium",color:"primary",textAlign:"center",sx:{my:"0.2rem"},children:"Raised Flag"}),e(B,{focused:!0,id:"outlined-multiline-static",label:"Raised Flag Comments",placeholder:"No Red Flag Raised",multiline:!0,readOnly:!0,rows:"4",name:"redFlag",defaultValue:p!=null?p:"No Red Flag Raised",onChange:S,className:d.textField,margin:"normal",variant:"outlined",inputProps:{readOnly:!0}})]})})]})};export{Vt as E,Gt as O,Pt as R};
